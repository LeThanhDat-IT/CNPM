<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Thống Kê Doanh Thu Theo Ngày - THE COW HOTEL</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px);}
      to { opacity: 1; transform: none;}
    }
    body {
      font-family: 'Montserrat', Arial, sans-serif;
      background: linear-gradient(120deg, #f6f8fb 60%, #e9eafc 100%);
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    .container {
      max-width: 980px;
      margin: 48px auto 0 auto;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 8px 32px rgba(34,59,121,0.13);
      padding: 38px 32px 32px 32px;
      position: relative;
      overflow: hidden;
      animation: fadeIn 0.7s;
    }
    .container::before {
      content: "";
      position: absolute;
      top: -80px; right: -80px;
      width: 220px; height: 220px;
      background: radial-gradient(circle, #d10000 0%, #fff0 70%);
      opacity: 0.13;
      z-index: 0;
    }
    h2 {
      color: #223B79;
      text-align: center;
      margin-bottom: 32px;
      font-size: 2.1em;
      letter-spacing: 1px;
      font-weight: 700;
      position: relative;
      z-index: 1;
    }
    .filter-bar {
      display: flex;
      gap: 18px;
      margin-bottom: 28px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: center;
      position: relative;
      z-index: 1;
    }
    .filter-bar label {
      font-weight: 600;
      color: #223B79;
      font-size: 1.08em;
    }
    .filter-bar input[type="date"] {
      padding: 10px 14px;
      border: 1.5px solid #cfd8e3;
      border-radius: 7px;
      font-size: 1.08em;
      background: #f8fafc;
      transition: border 0.2s;
    }
    .filter-bar input[type="date"]:focus {
      border-color: #1a2d6c;
      outline: none;
    }
    .filter-bar button {
      padding: 10px 28px;
      border: none;
      border-radius: 7px;
      background: linear-gradient(90deg, #1a2d6c 60%, #d10000 100%);
      color: #fff;
      font-weight: 700;
      font-size: 1.08em;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(34,59,121,0.08);
      transition: background 0.2s, transform 0.1s;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .filter-bar button:hover {
      background: linear-gradient(90deg, #d10000 60%, #1a2d6c 100%);
      transform: translateY(-2px) scale(1.03);
    }
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin-top: 18px;
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 12px rgba(34,59,121,0.06);
      position: relative;
      z-index: 1;
    }
    th, td {
      padding: 16px 10px;
      text-align: center;
      font-size: 1.04em;
    }
    th {
      background: linear-gradient(90deg, #f1f5f9 60%, #e9eafc 100%);
      color: #223b79;
      font-weight: 700;
      font-size: 1.08em;
      border-bottom: 2px solid #e5e7eb;
      letter-spacing: 0.5px;
    }
    tr:nth-child(even) { background: #f8fafc; }
    tr:hover { background: #f3f6ff; }
    .total-row td {
      font-weight: bold;
      color: #d10000;
      background: #f1f5f9;
      font-size: 1.08em;
      border-top: 2px solid #e5e7eb;
    }
    .no-data {
      color: #888;
      font-style: italic;
      font-size: 1.08em;
      padding: 30px 0;
      background: #fff;
    }
    .total-revenue-bar {
      text-align: right;
      margin-top: 22px;
      font-size: 1.15em;
      font-weight: 600;
      color: #223B79;
      position: relative;
      z-index: 1;
    }
    .total-revenue-bar .icon {
      color: #d10000;
      margin-right: 7px;
      font-size: 1.2em;
      vertical-align: -2px;
    }
    .total-revenue-bar .value {
      color: #d10000;
      font-size: 1.18em;
      font-weight: bold;
      margin-left: 4px;
    }
    .nav-bar {
      display: flex;
      gap: 16px;
      justify-content: center;
      align-items: center;
      margin-bottom: 32px;
      margin-top: 10px;
      z-index: 2;
      position: relative;
    }
    .nav-bar a {
      text-decoration: none;
      padding: 9px 22px;
      border-radius: 7px;
      background: linear-gradient(90deg, #1a2d6c 60%, #d10000 100%);
      color: #fff;
      font-weight: 600;
      font-size: 1em;
      box-shadow: 0 2px 8px rgba(34,59,121,0.08);
      transition: background 0.2s, transform 0.1s;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 7px;
    }
    .nav-bar a:hover, .nav-bar a.active {
      background: linear-gradient(90deg, #d10000 60%, #1a2d6c 100%);
      transform: translateY(-2px) scale(1.03);
      color: #fff;
    }
    @media (max-width: 900px) {
      .nav-bar { flex-wrap: wrap; gap: 8px; font-size: 0.97em;}
      .container { padding: 12px 2px; }
      .filter-bar { flex-direction: column; gap: 8px; }
      th, td { padding: 10px 4px; font-size: 0.98em; }
      h2 { font-size: 1.3em; }
    }
  </style>
</head>
<body>
  <div class="nav-bar">
    <a href="QuanLyKhachHang.html"><i class="fa-solid fa-users"></i> Quản lý khách hàng</a>
    <a href="QuanLyPhong.html"><i class="fa-solid fa-bed"></i> Quản lý phòng</a>
    <a href="quanly_tk.html"><i class="fa-solid fa-user-gear"></i> Quản lý tài khoản</a>
    <a href="ThongKeThuNhap.html" class="active"><i class="fa-solid fa-chart-line"></i> Thống kê thu nhập</a>
  </div>
  <div class="container">
    <h2><i class="fa-solid fa-chart-line" style="color:#d10000;margin-right:10px;"></i>Thống Kê Doanh Thu Theo Ngày</h2>
    <div class="filter-bar">
      <label for="filter-date"><i class="fa-regular fa-calendar-days"></i> Chọn ngày:</label>
      <input type="date" id="filter-date">
      <button id="stats-btn"><i class="fa-solid fa-magnifying-glass-chart"></i> Xem thống kê</button>
    </div>
    <table id="income-table">
      <thead>
        <tr>
          <th>Mã phòng</th>
          <th>Tên phòng</th>
          <th>Tên khách</th>
          <th>Thời gian đặt</th>
          <th>Tổng tiền</th>
        </tr>
      </thead>
      <tbody>
        <!-- Dữ liệu sẽ được render bằng JS -->
      </tbody>
    </table>
    <div class="total-revenue-bar">
      <span class="icon"><i class="fa-solid fa-coins"></i></span>
      Tổng doanh thu ngày:
      <span id="total-revenue" class="value">0 đ</span>
    </div>
  </div>
  <script>
function formatCurrency(num) {
  return Number(num).toLocaleString('vi-VN') + ' đ';
}

function renderTable(data) {
  const tbody = document.querySelector("#income-table tbody");
  tbody.innerHTML = "";
  let total = 0;
  if (!data || data.length === 0) {
    tbody.innerHTML = `<tr><td colspan="5" class="no-data"><i class="fa-regular fa-face-frown"></i> Không có dữ liệu</td></tr>`;
  } else {
    data.forEach(row => {
      total += Number(row.total);
      tbody.innerHTML += `
        <tr>
          <td>${row.roomId}</td>
          <td>${row.roomName || '-'}</td>
          <td>${row.customerName}</td>
          <td>${row.date ? row.date.split('-').reverse().join('-') : ''}</td>
          <td style="color:#d10000;font-weight:600;">${formatCurrency(row.total)}</td>
        </tr>
      `;
    });
  }
  document.getElementById('total-revenue').textContent = formatCurrency(total);
}

async function fetchIncome() {
  const filterDate = document.getElementById('filter-date').value;
  if (!filterDate) {
    renderTable([]);
    return;
  }
  const res = await fetch(`PHP/get_income.php?type=Theo ngày&date=${encodeURIComponent(filterDate)}&t=${Date.now()}`);
  const data = await res.json();
  renderTable(data);
}

document.getElementById('stats-btn').addEventListener('click', fetchIncome);
window.addEventListener('DOMContentLoaded', () => {
  // Đặt mặc định ngày hôm nay cho input date
  const today = new Date().toISOString().slice(0, 10);
  document.getElementById('filter-date').value = today;
  fetchIncome();
});
  </script>
</body>
</html>